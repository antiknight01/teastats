<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Game Stats</title>

<style>
/* =====================================================================
   DESIGN SYSTEM — TOKENS
   ===================================================================== */
:root {
  --bg-0: #080a0f;
  --bg-1: #0e1118;
  --bg-2: #141926;
  --bg-3: #1a2030;
  --bg-4: #21283a;

  --border-0: #1f2535;
  --border-1: #2a3248;

  --text-0: #f5f7fb;
  --text-1: #d7dcec;
  --text-2: #a8b0c8;
  --text-3: #6f7893;

  --accent-0: #4da3ff;
  --accent-1: #6bb5ff;
  --accent-2: #2f6fbf;

  --win-bg: rgba(77,163,255,0.18);
  --win-text: #6bb5ff;

  --loss-bg: rgba(255,92,92,0.18);
  --loss-text: #ff7b7b;

  --radius-xs: 4px;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 18px;

  --shadow-sm: 0 1px 3px rgba(0,0,0,0.4);
  --shadow-md: 0 12px 32px rgba(0,0,0,0.55);

  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 24px;
  --space-6: 32px;
  --space-7: 48px;
  --space-8: 64px;

  --font-xs: 12px;
  --font-sm: 13px;
  --font-md: 14px;
  --font-lg: 16px;
  --font-xl: 20px;
  --font-xxl: 28px;

  --ease-fast: 120ms ease;
  --ease-med: 220ms ease;
  --ease-slow: 380ms ease;
}

/* =====================================================================
   RESET
   ===================================================================== */
*,
*::before,
*::after {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(
    1200px 800px at 50% -200px,
    #1a2340,
    var(--bg-0)
  );
  color: var(--text-0);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell;
}

a {
  color: inherit;
  text-decoration: none;
}

button, input {
  font-family: inherit;
}

/* =====================================================================
   APP SHELL
   ===================================================================== */
#app-root {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  position: sticky;
  top: 0;
  z-index: 20;
  backdrop-filter: blur(10px);
  background: linear-gradient(
    180deg,
    rgba(14,17,24,0.92),
    rgba(14,17,24,0.86)
  );
  border-bottom: 1px solid var(--border-0);
}

.header-inner {
  max-width: 1280px;
  margin: 0 auto;
  padding: var(--space-4);
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--space-4);
  align-items: center;
}

.logo {
  font-size: var(--font-xl);
  font-weight: 800;
  letter-spacing: 0.4px;
  cursor: pointer;
}

.logo:hover {
  color: var(--accent-0);
}

.search {
  position: relative;
}

.search input {
  width: 100%;
  padding: 12px 14px;
  background: var(--bg-2);
  border: 1px solid var(--border-0);
  border-radius: var(--radius-md);
  color: var(--text-0);
  transition: border var(--ease-fast), box-shadow var(--ease-fast);
}

.search input::placeholder {
  color: var(--text-3);
}

.search input:focus {
  outline: none;
  border-color: var(--accent-0);
  box-shadow: 0 0 0 1px var(--accent-0);
}

/* =====================================================================
   MAIN CONTENT
   ===================================================================== */
main {
  flex: 1;
  max-width: 1280px;
  margin: 0 auto;
  padding: var(--space-6) var(--space-4) var(--space-8);
  width: 100%;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: var(--space-5);
}

/* =====================================================================
   CARD SYSTEM
   ===================================================================== */
.card {
  background: linear-gradient(180deg, var(--bg-2), var(--bg-3));
  border: 1px solid var(--border-0);
  border-radius: var(--radius-lg);
  padding: var(--space-5);
  box-shadow: var(--shadow-sm);
  transition:
    transform var(--ease-fast),
    box-shadow var(--ease-fast),
    border var(--ease-fast);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: var(--border-1);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: var(--space-3);
}

.card-title {
  font-size: var(--font-lg);
  font-weight: 700;
}

.card-meta {
  font-size: var(--font-sm);
  color: var(--text-3);
}

/* =====================================================================
   LISTS / ROWS
   ===================================================================== */
.row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-3) 0;
  border-bottom: 1px solid var(--border-0);
}

.row:last-child {
  border-bottom: none;
}

.row.clickable {
  cursor: pointer;
  transition: background var(--ease-fast), padding var(--ease-fast);
}

.row.clickable:hover {
  background: rgba(255,255,255,0.03);
  padding-left: var(--space-2);
}

/* =====================================================================
   TABLE
   ===================================================================== */
table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-size: var(--font-xs);
  color: var(--text-3);
  padding-bottom: var(--space-2);
}

td {
  padding: var(--space-2) 0;
  font-size: var(--font-md);
}

/* =====================================================================
   BADGES
   ===================================================================== */
.badge {
  padding: 2px 10px;
  border-radius: 999px;
  font-size: var(--font-xs);
  font-weight: 700;
}

.badge.win {
  background: var(--win-bg);
  color: var(--win-text);
}

.badge.loss {
  background: var(--loss-bg);
  color: var(--loss-text);
}

/* =====================================================================
   STATES
   ===================================================================== */
.state {
  text-align: center;
  padding: var(--space-8);
  color: var(--text-2);
}

.spinner {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 4px solid var(--border-0);
  border-top-color: var(--accent-0);
  margin: 0 auto var(--space-4);
  animation: spin 0.9s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* =====================================================================
   MATCH DETAILS
   ===================================================================== */
.player {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.player-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.toggle {
  font-size: var(--font-sm);
  color: var(--accent-0);
  cursor: pointer;
}

.toggle:hover {
  text-decoration: underline;
}

.words {
  display: none;
  padding-left: var(--space-4);
}

.words li {
  font-size: var(--font-sm);
  color: var(--text-1);
  padding: 2px 0;
}

/* =====================================================================
   TIMELINE
   ===================================================================== */
.timeline-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) 0;
  border-bottom: 1px solid var(--border-0);
}

.timeline-item:last-child {
  border-bottom: none;
}

.timeline-meta {
  font-size: var(--font-sm);
  color: var(--text-3);
}

/* =====================================================================
   RESPONSIVE
   ===================================================================== */
@media (max-width: 760px) {
  .header-inner {
    grid-template-columns: 1fr;
  }
}
</style>
</head>

<body>
<div id="app-root">
  <header>
    <div class="header-inner">
      <div class="logo" id="go-home">Game Stats</div>
      <div class="search">
        <input id="search-input" placeholder="Search players…" />
      </div>
    </div>
  </header>
  <main id="app"></main>
</div>

<script>
/* =====================================================================
   CONFIG
   ===================================================================== */
const API_BASE = "https://tracker-s9qq.onrender.com";

/* =====================================================================
   ELEMENTS
   ===================================================================== */
const app = document.getElementById("app");
const searchInput = document.getElementById("search-input");
const goHome = document.getElementById("go-home");

/* =====================================================================
   NAVIGATION
   ===================================================================== */
goHome.onclick = () => navigate("/");

let searchTimer;
searchInput.oninput = () => {
  clearTimeout(searchTimer);
  const q = searchInput.value.trim();
  if (!q) return;
  searchTimer = setTimeout(() => {
    navigate("/search?q=" + encodeURIComponent(q));
  }, 300);
};

window.addEventListener("hashchange", router);

/* =====================================================================
   ROUTER
   ===================================================================== */
function router() {
  const hash = location.hash.slice(1) || "/";
  const [path, query] = hash.split("?");

  if (path === "/") return loadHome();
  if (path === "/search") return loadSearch(new URLSearchParams(query).get("q") || "");
  if (path.startsWith("/player/")) return loadPlayer(decodeURIComponent(path.slice(8)));
  if (path.startsWith("/match/")) return loadMatch(decodeURIComponent(path.slice(7)));
}

/* =====================================================================
   HELPERS
   ===================================================================== */
function navigate(path) {
  location.hash = "#" + path;
}

function loading() {
  app.innerHTML = `
    <div class="state">
      <div class="spinner"></div>
      Loading…
    </div>`;
}

function error() {
  app.innerHTML = `<div class="state">Failed to load data.</div>`;
}

async function fetchJSON(url) {
  const r = await fetch(url);
  if (!r.ok) throw new Error();
  return r.json();
}

/* =====================================================================
   HOME
   ===================================================================== */
async function loadHome() {
  loading();
  try {
    const data = await fetchJSON(API_BASE + "/");
    data.leaderboard.sort((a,b)=>b.wins-a.wins);

    app.innerHTML = `
      <div class="grid">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Leaderboard</div>
            <div class="card-meta">Wins</div>
          </div>
          <table>
            <thead>
              <tr>
                <th>Player</th><th>W</th><th>L</th><th>Games</th>
              </tr>
            </thead>
            <tbody>
              ${data.leaderboard.map(p=>`
                <tr class="clickable" data-player="${p.display_name}">
                  <td>${p.display_name}</td>
                  <td>${p.wins}</td>
                  <td>${p.losses}</td>
                  <td>${p.games_played}</td>
                </tr>`).join("")}
            </tbody>
          </table>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Recent Matches</div>
            <div class="card-meta">Latest</div>
          </div>
          ${data.recent_matches.map(m=>{
            const id = m.id || m.match_id;
            return `<div class="row clickable" data-match="${id}">Match ${id}</div>`;
          }).join("")}
        </div>
      </div>`;
    bindLinks();
  } catch { error(); }
}

/* =====================================================================
   SEARCH
   ===================================================================== */
async function loadSearch(q) {
  loading();
  try {
    const players = await fetchJSON(API_BASE + "/players?q=" + encodeURIComponent(q));
    app.innerHTML = `
      <div class="card">
        <div class="card-header">
          <div class="card-title">Search</div>
          <div class="card-meta">"${q}"</div>
        </div>
        ${players.map(p=>`
          <div class="row clickable" data-player="${p.name}">
            <strong>${p.name}</strong>
            <span class="card-meta">${p.wins}W ${p.losses}L</span>
          </div>`).join("")}
      </div>`;
    bindLinks();
  } catch { error(); }
}

/* =====================================================================
   PLAYER
   ===================================================================== */
async function loadPlayer(name) {
  loading();
  try {
    const data = await fetchJSON(API_BASE + "/player/" + encodeURIComponent(name));
    const p = data.profile;

    app.innerHTML = `
      <div class="card">
        <div class="card-header">
          <div class="card-title">${p.display_name}</div>
          <div class="card-meta">${p.games_played} games</div>
        </div>
        <div class="card-meta">${p.wins}W ${p.losses}L · ${p.total_words} words</div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Timeline</div>
          <div class="card-meta">History</div>
        </div>
        ${data.timeline.map(t=>`
          <div class="timeline-item clickable" data-match="${t.match_id}">
            <span class="badge ${t.result}">${t.result}</span>
            <div>
              <div>Match ${t.match_id}</div>
              <div class="timeline-meta">${t.ago}</div>
            </div>
          </div>`).join("")}
      </div>`;
    bindLinks();
  } catch { error(); }
}

/* =====================================================================
   MATCH
   ===================================================================== */
async function loadMatch(id) {
  loading();
  try {
    const m = await fetchJSON(API_BASE + "/match/" + encodeURIComponent(id));
    app.innerHTML = `
      <div class="card">
        <div class="card-header">
          <div class="card-title">Match ${m.id}</div>
          <div class="card-meta">Winner: ${m.winner} · ${m.duration_sec}s</div>
        </div>
      </div>

      ${m.players.map(p=>`
        <div class="card">
          <div class="player">
            <div class="player-head">
              <div>
                <strong>${p.name}</strong>
                <span class="badge ${p.result}">${p.result}</span>
              </div>
              <div class="card-meta">${p.word_count} words</div>
            </div>
            <div class="toggle">Show words</div>
            <ul class="words">
              ${p.words.map(w=>`<li>${w}</li>`).join("")}
            </ul>
          </div>
        </div>`).join("")}`;

    document.querySelectorAll(".toggle").forEach(t=>{
      t.onclick = ()=>{
        const ul = t.nextElementSibling;
        const open = ul.style.display === "block";
        ul.style.display = open ? "none" : "block";
        t.textContent = open ? "Show words" : "Hide words";
      };
    });
  } catch { error(); }
}

/* =====================================================================
   BINDINGS
   ===================================================================== */
function bindLinks() {
  document.querySelectorAll("[data-player]").forEach(el=>{
    el.onclick = ()=>navigate("/player/" + encodeURIComponent(el.dataset.player));
  });
  document.querySelectorAll("[data-match]").forEach(el=>{
    el.onclick = ()=>navigate("/match/" + encodeURIComponent(el.dataset.match));
  });
}

/* =====================================================================
   INIT
   ===================================================================== */
router();
</script>
</body>
</html>
