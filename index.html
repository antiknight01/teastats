<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>☕ Blacktea Stats</title>

<style>
/* ======================================================
   DESIGN SYSTEM (STABLE)
   ====================================================== */
:root{
  --bg:#0b1020;
  --panel:#121833;
  --panel-2:#171f42;
  --border:#2a3470;

  --text:#f7f9ff;
  --muted:#aeb6df;

  --accent:#6bb2ff;
  --win:#7fc4ff;
  --loss:#ff8b8b;

  --radius:16px;
  --radius-lg:22px;

  --shadow:0 16px 40px rgba(0,0,0,.45);
  --ease:280ms cubic-bezier(.22,.61,.36,1);
}

*{box-sizing:border-box}
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
}

/* ======================================================
   HEADER
   ====================================================== */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:rgba(11,16,32,.92);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
}
.header-inner{
  max-width:1400px;
  margin:auto;
  padding:22px;
  font-size:26px;
  font-weight:900;
}

/* ======================================================
   MAIN
   ====================================================== */
main{
  max-width:1400px;
  margin:auto;
  padding:48px 22px 120px;
  animation:fade .4s ease both;
}
@keyframes fade{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}

/* ======================================================
   GENERIC UI
   ====================================================== */
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:28px;
  margin-bottom:36px;
  box-shadow:var(--shadow);
}
.card-title{
  font-size:22px;
  font-weight:900;
  margin-bottom:20px;
}
.muted{color:var(--muted);font-size:13px}
.back{
  color:var(--accent);
  font-weight:800;
  cursor:pointer;
  margin-bottom:18px;
  display:inline-block;
}

/* ======================================================
   HOME
   ====================================================== */
.home-actions{
  display:flex;
  justify-content:flex-end;
  margin-bottom:26px;
}
.btn{
  padding:12px 20px;
  border-radius:999px;
  background:var(--accent);
  color:#071427;
  font-weight:900;
  cursor:pointer;
}

/* ======================================================
   LEADERBOARD
   ====================================================== */
.lb-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:18px;
}
.lb-card{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  cursor:pointer;
  transition:var(--ease);
}
.lb-card:hover{
  transform:translateY(-6px);
  box-shadow:var(--shadow);
}
.lb-name{font-size:18px;font-weight:900}
.lb-stats{
  margin-top:8px;
  display:flex;
  gap:14px;
  font-size:13px;
  color:var(--muted);
}

/* ======================================================
   PROFILE
   ====================================================== */
.profile-hero{
  display:grid;
  grid-template-columns:1.4fr 2fr;
  gap:26px;
}
.profile-name{
  font-size:30px;
  font-weight:900;
}
.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
}
.stat{
  background:var(--panel-2);
  border-radius:var(--radius);
  padding:18px;
  text-align:center;
}
.stat-value{
  font-size:24px;
  font-weight:900;
}
.stat-label{
  font-size:12px;
  color:var(--muted);
}
.compare-btn{
  margin-top:18px;
  display:inline-block;
  padding:12px 20px;
  border-radius:999px;
  background:var(--accent);
  color:#071427;
  font-weight:900;
  cursor:pointer;
}

/* ======================================================
   ROWS
   ====================================================== */
.row{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:16px;
  padding:18px;
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:14px;
  cursor:pointer;
}
.row:hover{background:#1a2350}

/* ======================================================
   WORDS
   ====================================================== */
.words{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.word{
  padding:6px 14px;
  border-radius:999px;
  background:#1e285a;
  font-size:12px;
}

/* ======================================================
   COMPARE
   ====================================================== */
.compare-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:24px;
}
.compare-card{
  background:var(--panel-2);
  border-radius:var(--radius);
  padding:22px;
}

@media(max-width:900px){
  .profile-hero,.compare-grid{grid-template-columns:1fr}
  .stats{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>
<header>
  <div class="header-inner">☕ Blacktea Stats</div>
</header>

<main id="app"></main>

<script>
const API="https://tracker-s9qq.onrender.com";
const app=document.getElementById("app");

window.addEventListener("hashchange",router);
function go(p){location.hash="#"+p}
function dur(sec){return sec<60?sec+"s":(sec/60).toFixed(1)+" min"}

async function j(u){
  const r=await fetch(u);
  if(!r.ok)throw 0;
  return r.json();
}

/* ================= ROUTER ================= */
function router(){
  const h=location.hash.slice(1)||"/";
  if(h==="/")home();
  else if(h==="/recent")recent();
  else if(h.startsWith("/player/"))player(decodeURIComponent(h.slice(8)));
  else if(h.startsWith("/match/"))match(decodeURIComponent(h.slice(7)));
  else if(h.startsWith("/compare/")){
    const [a,b]=h.slice(9).split("|");
    compare(a,b);
  }
}

/* ================= HOME ================= */
async function home(){
  const d=await j(API+"/");
  d.leaderboard.sort((a,b)=>b.wins-a.wins);

  app.innerHTML=`
    <div class="home-actions">
      <div class="btn" onclick="go('/recent')">Recent Games</div>
    </div>

    <div class="card">
      <div class="card-title">Leaderboard</div>
      <div class="lb-grid">
        ${d.leaderboard.map(p=>`
          <div class="lb-card" onclick="go('/player/${encodeURIComponent(p.display_name)}')">
            <div class="lb-name">${p.display_name}</div>
            <div class="lb-stats">
              <span>${p.wins}W</span>
              <span>${p.losses}L</span>
              <span>${p.games_played} games</span>
            </div>
          </div>`).join("")}
      </div>
    </div>`;
}

/* ================= RECENT ================= */
async function recent(){
  const d=await j(API+"/");
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>
    <div class="card">
      <div class="card-title">Recent Games</div>
      ${d.recent_matches.map(m=>`
        <div class="row" onclick="go('/match/${m.id||m.match_id}')">
          <div><strong>${m.winner}</strong> won</div>
          <div class="muted">${dur(m.duration_sec||0)}</div>
          <div class="muted">View</div>
        </div>`).join("")}
    </div>`;
}

/* ================= PLAYER ================= */
async function player(name){
  const d=await j(API+"/player/"+encodeURIComponent(name));

  let totalSeconds=0, words=[];
  let bestWin=0, curWin=0, curLoss=0;
  let currentStreak={type:null,count:0};

  for(const id of d.profile.matches){
    const m=await j(API+"/match/"+id);
    totalSeconds+=m.duration_sec;
    const p=m.players.find(x=>x.name===d.profile.display_name);
    if(p) words.push(...p.words);
  }

  d.timeline.forEach(t=>{
    if(t.result==="win"){
      curWin++; curLoss=0;
      bestWin=Math.max(bestWin,curWin);
    }else{
      curLoss++; curWin=0;
    }
    currentStreak={type:t.result,count:t.result==="win"?curWin:curLoss};
  });

  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="profile-hero">
        <div>
          <div class="profile-name">${d.profile.display_name}</div>
          <div class="muted">${d.profile.games_played} games · ${dur(totalSeconds)}</div>
          <div class="compare-btn" onclick="openCompare('${d.profile.display_name}')">
            Compare Player
          </div>
        </div>

        <div class="stats">
          <div class="stat"><div class="stat-value">${d.profile.wins}</div><div class="stat-label">Wins</div></div>
          <div class="stat"><div class="stat-value">${d.profile.losses}</div><div class="stat-label">Losses</div></div>
          <div class="stat"><div class="stat-value">${d.profile.games_played}</div><div class="stat-label">Games</div></div>
          <div class="stat"><div class="stat-value">${words.length}</div><div class="stat-label">Words</div></div>
          <div class="stat"><div class="stat-value">${bestWin}</div><div class="stat-label">Best Win Streak</div></div>
          <div class="stat">
            <div class="stat-value">${currentStreak.count}</div>
            <div class="stat-label">Current ${currentStreak.type}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Recent Matches</div>
      ${d.timeline.map(t=>`
        <div class="row" onclick="go('/match/${t.match_id}')">
          <div>${t.result==="win"?"Victory":"Defeat"}</div>
          <div class="muted">${t.ago}</div>
          <div class="muted">Open</div>
        </div>`).join("")}
    </div>`;
}

/* ================= COMPARE ================= */
async function compare(a,b){
  const A=await j(API+"/player/"+a);
  const B=await j(API+"/player/"+b);

  async function collect(p){
    let seconds=0, words=[];
    for(const id of p.profile.matches){
      const m=await j(API+"/match/"+id);
      seconds+=m.duration_sec;
      const pl=m.players.find(x=>x.name===p.profile.display_name);
      if(pl) words.push(...pl.words);
    }
    return {seconds,words};
  }

  const da=await collect(A);
  const db=await collect(B);
  const shared=[...new Set(da.words.filter(w=>db.words.includes(w)))];

  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="card-title">Player Comparison</div>
      <div class="compare-grid">
        ${compareCard(A,da)}
        ${compareCard(B,db)}
      </div>
    </div>

    <div class="card">
      <div class="card-title">Shared Words (${shared.length})</div>
      <div class="words">${shared.map(w=>`<div class="word">${w}</div>`).join("")}</div>
    </div>`;
}

function compareCard(p,d){
  const wr=(p.profile.wins/p.profile.games_played*100).toFixed(1);
  return `
    <div class="compare-card">
      <strong>${p.profile.display_name}</strong>
      <div class="muted">${p.profile.games_played} games</div>
      <div class="muted">${p.profile.wins}W · ${p.profile.losses}L · ${wr}% WR</div>
      <div class="muted">${dur(d.seconds)} played</div>
      <div class="muted">${d.words.length} words</div>
    </div>`;
}

/* ================= MATCH ================= */
async function match(id){
  const m=await j(API+"/match/"+id);
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>
    <div class="card">
      <div class="card-title">${m.winner} won</div>
      <div class="muted">${dur(m.duration_sec)}</div>
      ${m.players.map(p=>`
        <div style="margin-top:16px">
          <strong>${p.name}</strong>
          <div class="words">${p.words.map(w=>`<div class="word">${w}</div>`).join("")}</div>
        </div>`).join("")}
    </div>`;
}

router();
</script>
</body>
   </html>
