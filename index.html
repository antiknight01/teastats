<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>☕ Blacktea Stats</title>

<style>
/* =====================================================
   CORE DESIGN SYSTEM
   ===================================================== */
:root{
  --bg:#0b1020;
  --panel:#121833;
  --panel-2:#171f42;
  --border:#2a3470;

  --text:#f7f9ff;
  --muted:#aeb6df;

  --accent:#6bb2ff;
  --accent-soft:#8fc6ff;
  --win:#7fc4ff;
  --loss:#ff8b8b;

  --radius:16px;
  --radius-lg:22px;

  --shadow:0 18px 50px rgba(0,0,0,.45);
  --ease:300ms cubic-bezier(.22,.61,.36,1);
}

*{box-sizing:border-box}
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
}
a{text-decoration:none;color:inherit}

/* =====================================================
   HEADER
   ===================================================== */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:rgba(11,16,32,.9);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
}
.header-inner{
  max-width:1400px;
  margin:auto;
  padding:22px;
  font-size:26px;
  font-weight:900;
}

/* =====================================================
   MAIN
   ===================================================== */
main{
  max-width:1400px;
  margin:auto;
  padding:48px 22px 120px;
  animation:fade .4s ease both;
}
@keyframes fade{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}

/* =====================================================
   SEARCH
   ===================================================== */
.search-wrap{
  max-width:640px;
  margin:0 auto 50px;
  position:relative;
}
.search-input{
  width:100%;
  padding:18px 22px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  font-size:16px;
}
.search-input:focus{
  outline:none;
  border-color:var(--accent);
}
.search-btn{
  position:absolute;
  right:6px;
  top:6px;
  bottom:6px;
  padding:0 22px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:#071427;
  font-weight:900;
  cursor:pointer;
}
.search-results{
  position:absolute;
  top:110%;
  width:100%;
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:18px;
  overflow:hidden;
  animation:fade .2s ease both;
}
.search-item{
  padding:14px 20px;
  cursor:pointer;
}
.search-item:hover{background:#1f2a5c}

/* =====================================================
   CARDS
   ===================================================== */
.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:28px;
  margin-bottom:36px;
  box-shadow:var(--shadow);
}
.card-title{
  font-size:22px;
  font-weight:900;
  margin-bottom:20px;
}
.muted{color:var(--muted);font-size:13px}

/* =====================================================
   LEADERBOARD
   ===================================================== */
.lb-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:18px;
}
.lb-card{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  cursor:pointer;
  transition:var(--ease);
}
.lb-card:hover{
  transform:translateY(-6px);
  box-shadow:var(--shadow);
}
.lb-name{font-size:18px;font-weight:900}
.lb-stats{
  margin-top:8px;
  display:flex;
  gap:14px;
  font-size:13px;
  color:var(--muted);
}

/* =====================================================
   MATCH ROW
   ===================================================== */
.row{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:16px;
  padding:18px;
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:14px;
  cursor:pointer;
  transition:var(--ease);
}
.row:hover{
  transform:translateY(-4px);
  box-shadow:var(--shadow);
}

/* =====================================================
   PROFILE
   ===================================================== */
.player-hero{
  display:grid;
  grid-template-columns:1.2fr 2fr;
  gap:24px;
}
.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}
.stat{
  background:var(--panel-2);
  border-radius:var(--radius);
  padding:20px;
  text-align:center;
}
.stat-value{font-size:26px;font-weight:900}
.stat-label{font-size:12px;color:var(--muted)}

.compare-btn{
  margin-top:18px;
  display:inline-block;
  padding:12px 20px;
  border-radius:999px;
  background:var(--accent);
  color:#071427;
  font-weight:900;
  cursor:pointer;
}

/* =====================================================
   WORDS
   ===================================================== */
.words{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.word{
  padding:6px 14px;
  border-radius:999px;
  background:#1e285a;
  font-size:12px;
  animation:pop .25s ease both;
}
@keyframes pop{
  from{opacity:0;transform:scale(.85)}
  to{opacity:1;transform:none}
}

/* =====================================================
   MODAL (COMPARE)
   ===================================================== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modal-box{
  background:var(--panel);
  border-radius:22px;
  padding:28px;
  width:420px;
}
.modal-title{
  font-size:20px;
  font-weight:900;
  margin-bottom:14px;
}
.modal input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--panel-2);
  color:var(--text);
}
.modal-list{
  margin-top:12px;
}
.modal-item{
  padding:10px;
  cursor:pointer;
}
.modal-item:hover{background:#1f2a5c}

/* =====================================================
   UTIL
   ===================================================== */
.back{
  color:var(--accent);
  font-weight:800;
  cursor:pointer;
  margin-bottom:18px;
  display:inline-block;
}
</style>
</head>

<body>
<header>
  <div class="header-inner">☕ Blacktea Stats</div>
</header>

<main id="app"></main>

<script>
const API="https://tracker-s9qq.onrender.com";
const app=document.getElementById("app");

/* ================= SEARCH ================= */
let sTimer;
function searchBar(){
  return `
    <div class="search-wrap">
      <input class="search-input" placeholder="Search players…" oninput="onSearch(this.value)">
      <button class="search-btn">Search</button>
      <div id="search-results"></div>
    </div>`;
}

async function onSearch(q){
  clearTimeout(sTimer);
  const rBox=document.getElementById("search-results");
  if(!q){rBox.innerHTML="";return;}
  sTimer=setTimeout(async()=>{
    const ps=await (await fetch(API+"/players?q="+encodeURIComponent(q))).json();
    rBox.innerHTML=`
      <div class="search-results">
        ${ps.map(p=>`
          <div class="search-item" onclick="go('/player/${encodeURIComponent(p.name)}')">${p.name}</div>`).join("")}
      </div>`;
  },200);
}

/* ================= ROUTER ================= */
window.addEventListener("hashchange",router);
function go(p){location.hash="#"+p}
function dur(s){return s<60?s+"s":(s/60).toFixed(1)+" min"}

async function router(){
  const h=location.hash.slice(1)||"/";
  if(h==="/")home();
  else if(h.startsWith("/player/"))player(decodeURIComponent(h.slice(8)));
  else if(h.startsWith("/match/"))match(decodeURIComponent(h.slice(7)));
  else if(h.startsWith("/compare/")){
    const [a,b]=h.slice(9).split("|");
    compare(a,b);
  }
}

/* ================= HOME ================= */
async function home(){
  const d=await (await fetch(API+"/")).json();
  app.innerHTML=`
    ${searchBar()}

    <div class="card">
      <div class="card-title">Leaderboard</div>
      <div class="lb-grid">
        ${d.leaderboard.map(p=>`
          <div class="lb-card" onclick="go('/player/${encodeURIComponent(p.display_name)}')">
            <div class="lb-name">${p.display_name}</div>
            <div class="lb-stats">
              <span>${p.wins}W</span>
              <span>${p.losses}L</span>
              <span>${p.games_played} games</span>
            </div>
          </div>`).join("")}
      </div>
    </div>

    <div class="card">
      <div class="card-title">Recent Games</div>
      ${d.recent_matches.map(m=>`
        <div class="row" onclick="go('/match/${m.id||m.match_id}')">
          <div><strong>${m.winner}</strong> won</div>
          <div class="muted">${dur(m.duration_sec||0)}</div>
          <div class="muted">View</div>
        </div>`).join("")}
    </div>`;
}

/* ================= PLAYER ================= */
async function player(name){
  const d=await (await fetch(API+"/player/"+encodeURIComponent(name))).json();

  let words=[];
  for(const id of d.profile.matches){
    const m=await (await fetch(API+"/match/"+id)).json();
    const p=m.players.find(x=>x.name===d.profile.display_name);
    if(p) words.push(...p.words);
  }

  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="player-hero">
        <div>
          <div class="card-title">${d.profile.display_name}</div>
          <div class="muted">${d.profile.games_played} games · ${words.length} words</div>
          <div class="compare-btn" onclick="openCompare('${d.profile.display_name}')">
            Compare Player
          </div>
        </div>
        <div class="stats">
          <div class="stat"><div class="stat-value">${d.profile.wins}</div><div class="stat-label">Wins</div></div>
          <div class="stat"><div class="stat-value">${d.profile.losses}</div><div class="stat-label">Losses</div></div>
          <div class="stat"><div class="stat-value">${d.profile.games_played}</div><div class="stat-label">Games</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Words Used</div>
      <div class="words">${words.map(w=>`<div class="word">${w}</div>`).join("")}</div>
    </div>`;
}

/* ================= COMPARE MODAL ================= */
async function openCompare(a){
  const ps=await (await fetch(API+"/players?q=")).json();
  document.body.insertAdjacentHTML("beforeend",`
    <div class="modal" onclick="this.remove()">
      <div class="modal-box" onclick="event.stopPropagation()">
        <div class="modal-title">Compare with…</div>
        <input placeholder="Search player…" oninput="filterCompare(this.value)">
        <div class="modal-list">
          ${ps.filter(p=>p.name!==a).map(p=>`
            <div class="modal-item" onclick="go('/compare/${encodeURIComponent(a)}|${encodeURIComponent(p.name)}')">
              ${p.name}
            </div>`).join("")}
        </div>
      </div>
    </div>`);
}

function filterCompare(q){
  document.querySelectorAll(".modal-item").forEach(i=>{
    i.style.display=i.textContent.toLowerCase().includes(q.toLowerCase())?"block":"none";
  });
}

/* ================= COMPARE ================= */
async function compare(a,b){
  const A=await (await fetch(API+"/player/"+a)).json();
  const B=await (await fetch(API+"/player/"+b)).json();
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>
    <div class="card">
      <div class="card-title">Comparison</div>
      <div class="player-hero">
        <div>
          <strong>${A.profile.display_name}</strong>
          <div class="muted">${A.profile.wins}W ${A.profile.losses}L</div>
        </div>
        <div>
          <strong>${B.profile.display_name}</strong>
          <div class="muted">${B.profile.wins}W ${B.profile.losses}L</div>
        </div>
      </div>
    </div>`;
}

/* ================= MATCH ================= */
async function match(id){
  const m=await (await fetch(API+"/match/"+id)).json();
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>
    <div class="card">
      <div class="card-title">${m.winner} won</div>
      <div class="muted">${dur(m.duration_sec)}</div>
      ${m.players.map(p=>`
        <div style="margin-top:16px">
          <strong>${p.name}</strong>
          <div class="words">${p.words.map(w=>`<div class="word">${w}</div>`).join("")}</div>
        </div>`).join("")}
    </div>`;
}

router();
</script>
</body>
</html>
