<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Game Stats</title>

<style>
/* =========================================================
   DESIGN TOKENS
   ========================================================= */
:root{
  --bg-0:#07090e;
  --bg-1:#0d111a;
  --bg-2:#141a28;
  --bg-3:#1b2335;
  --bg-4:#232d44;

  --border-0:#1f2740;
  --border-1:#2d3a5e;

  --text-0:#f5f7fb;
  --text-1:#d7dcec;
  --text-2:#a8b0c8;
  --text-3:#6f7893;

  --accent:#4da3ff;
  --accent-glow:rgba(77,163,255,.35);

  --win:#5fb0ff;
  --win-bg:rgba(95,176,255,.18);
  --loss:#ff7b7b;
  --loss-bg:rgba(255,123,123,.18);

  --radius-sm:8px;
  --radius-md:14px;
  --radius-lg:22px;

  --shadow-sm:0 4px 10px rgba(0,0,0,.45);
  --shadow-lg:0 24px 70px rgba(0,0,0,.65);

  --space-1:4px;
  --space-2:8px;
  --space-3:12px;
  --space-4:16px;
  --space-5:24px;
  --space-6:32px;
  --space-7:48px;
  --space-8:64px;

  --font-xs:12px;
  --font-sm:13px;
  --font-md:15px;
  --font-lg:18px;
  --font-xl:22px;
  --font-xxl:34px;

  --ease:220ms cubic-bezier(.4,0,.2,1);
}

/* =========================================================
   RESET
   ========================================================= */
*,
*::before,
*::after{box-sizing:border-box}
html,body{
  margin:0;
  background:radial-gradient(1200px 700px at 50% -250px,#1c2a55,var(--bg-0));
  color:var(--text-0);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
}
a{text-decoration:none;color:inherit}

/* =========================================================
   LAYOUT
   ========================================================= */
#app-root{min-height:100vh;display:flex;flex-direction:column}

header{
  position:sticky;top:0;z-index:20;
  background:linear-gradient(180deg,rgba(13,17,26,.96),rgba(13,17,26,.88));
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border-0);
}

.header-inner{
  max-width:1400px;
  margin:auto;
  padding:var(--space-4);
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:var(--space-4);
  align-items:center;
}

.logo{
  font-size:var(--font-xl);
  font-weight:900;
  cursor:pointer;
}
.logo:hover{color:var(--accent)}

.search input{
  width:100%;
  padding:14px 16px;
  border-radius:var(--radius-md);
  border:1px solid var(--border-0);
  background:var(--bg-2);
  color:var(--text-0);
}

.recent-btn{
  padding:12px 18px;
  border-radius:999px;
  font-size:var(--font-sm);
  font-weight:800;
  background:linear-gradient(180deg,var(--accent),#2f78d6);
  color:#061428;
  cursor:pointer;
  transition:transform var(--ease),box-shadow var(--ease);
}
.recent-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 0 0 6px rgba(77,163,255,.15),0 12px 30px rgba(0,0,0,.6);
}

main{
  max-width:1400px;
  margin:auto;
  width:100%;
  padding:var(--space-6) var(--space-4) var(--space-8);
  flex:1;
}

/* =========================================================
   LEADERBOARD
   ========================================================= */
.leaderboard{
  width:100%;
  background:linear-gradient(180deg,var(--bg-2),var(--bg-3));
  border:1px solid var(--border-0);
  border-radius:var(--radius-lg);
  padding:var(--space-6);
  box-shadow:var(--shadow-lg);
}

.lb-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:var(--space-4);
}

.lb-title{font-size:var(--font-xxl);font-weight:900}
.lb-sub{font-size:var(--font-sm);color:var(--text-3)}

table{width:100%;border-collapse:collapse}
th{
  text-align:left;
  font-size:var(--font-xs);
  color:var(--text-3);
  padding-bottom:var(--space-2);
}
td{padding:var(--space-3) 0;font-size:var(--font-md)}
tr.clickable{cursor:pointer}
tr.clickable:hover{background:rgba(255,255,255,.04)}

/* =========================================================
   CARDS
   ========================================================= */
.card{
  background:linear-gradient(180deg,var(--bg-2),var(--bg-3));
  border:1px solid var(--border-0);
  border-radius:var(--radius-lg);
  padding:var(--space-6);
  box-shadow:var(--shadow-sm);
  margin-top:var(--space-6);
}

.card-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:var(--space-4);
}

.card-title{font-size:var(--font-lg);font-weight:900}
.card-meta{font-size:var(--font-sm);color:var(--text-3)}

/* =========================================================
   ROWS (CLEAR SEPARATION)
   ========================================================= */
.row{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:var(--space-4);
  padding:var(--space-4);
  border-radius:var(--radius-md);
  margin-bottom:var(--space-3);
  border:1px solid var(--border-0);
}
.row.clickable{cursor:pointer}
.row.clickable:hover{background:rgba(255,255,255,.04)}

/* =========================================================
   BADGES
   ========================================================= */
.badge{
  padding:3px 12px;
  border-radius:999px;
  font-size:var(--font-xs);
  font-weight:800;
}
.badge.win{background:var(--win-bg);color:var(--win)}
.badge.loss{background:var(--loss-bg);color:var(--loss)}

/* =========================================================
   PLAYER PROFILE
   ========================================================= */
.player-hero{
  display:grid;
  grid-template-columns:1.3fr 2fr;
  gap:var(--space-6);
}

.player-name{
  font-size:var(--font-xxl);
  font-weight:900;
}

.player-sub{
  font-size:var(--font-sm);
  color:var(--text-3);
  margin-top:var(--space-2);
}

.stats{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:var(--space-4);
}

.stat{
  background:var(--bg-4);
  border-radius:var(--radius-md);
  padding:var(--space-4);
  text-align:center;
  cursor:pointer;
}
.stat:hover{background:#2c3652}

.stat-value{
  font-size:var(--font-xxl);
  font-weight:900;
}
.stat-label{
  font-size:var(--font-sm);
  color:var(--text-3);
}

/* =========================================================
   MATCH VIEW
   ========================================================= */
.match-meta{
  display:flex;
  gap:var(--space-5);
  font-size:var(--font-sm);
  color:var(--text-2);
}

.player-block{
  margin-top:var(--space-5);
}

.words{
  margin-top:var(--space-2);
  padding-left:var(--space-4);
}
.words li{font-size:var(--font-sm);color:var(--text-1)}

/* =========================================================
   STATES
   ========================================================= */
.state{text-align:center;padding:var(--space-7);color:var(--text-2)}
.spinner{
  width:48px;height:48px;
  border-radius:50%;
  border:4px solid var(--border-0);
  border-top-color:var(--accent);
  margin:0 auto var(--space-4);
  animation:spin .9s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* =========================================================
   RESPONSIVE
   ========================================================= */
@media(max-width:900px){
  .header-inner{grid-template-columns:1fr}
  .player-hero{grid-template-columns:1fr}
}
</style>
</head>

<body>
<div id="app-root">
<header>
  <div class="header-inner">
    <div class="logo" id="nav-home">Game Stats</div>
    <div class="search"><input id="search-input" placeholder="Search players…"></div>
    <div class="recent-btn" id="nav-recent">Recent Games</div>
  </div>
</header>
<main id="app"></main>
</div>

<script>
const API_BASE="https://tracker-s9qq.onrender.com";
const app=document.getElementById("app");
const navHome=document.getElementById("nav-home");
const navRecent=document.getElementById("nav-recent");
const searchInput=document.getElementById("search-input");

navHome.onclick=()=>go("/");
navRecent.onclick=()=>go("/recent");

let t;
searchInput.oninput=()=>{
  clearTimeout(t);
  const q=searchInput.value.trim();
  if(!q)return;
  t=setTimeout(()=>go("/search?q="+encodeURIComponent(q)),300);
};

window.addEventListener("hashchange",router);

function go(p){location.hash="#"+p}
function loading(){app.innerHTML=`<div class="state"><div class="spinner"></div>Loading…</div>`}
function error(){app.innerHTML=`<div class="state">Failed to load data.</div>`}
async function fetchJSON(u){const r=await fetch(u);if(!r.ok)throw 0;return r.json()}
function fmtDuration(sec){
  if(sec<60) return sec+"s";
  if(sec<3600) return (sec/60).toFixed(1)+" min";
  const m=Math.floor(sec/60),s=sec%60;
  return m+":"+(s<10?"0":"")+s;
}

/* ================= ROUTER ================= */
function router(){
  const h=location.hash.slice(1)||"/";
  const [p,q]=h.split("?");
  if(p==="/")home();
  else if(p==="/recent")recent();
  else if(p==="/search")search(new URLSearchParams(q).get("q")||"");
  else if(p.startsWith("/player/"))player(decodeURIComponent(p.slice(8)));
  else if(p.startsWith("/match/"))match(decodeURIComponent(p.slice(7)));
}

/* ================= HOME ================= */
async function home(){
  loading();
  try{
    const d=await fetchJSON(API_BASE+"/");
    d.leaderboard.sort((a,b)=>b.wins-a.wins);
    app.innerHTML=`
      <section class="leaderboard">
        <div class="lb-header">
          <div class="lb-title">Leaderboard</div>
          <div class="lb-sub">Ranked by wins</div>
        </div>
        <table>
          <thead><tr><th>Player</th><th>Wins</th><th>Losses</th><th>Games</th></tr></thead>
          <tbody>
            ${d.leaderboard.map(p=>`
              <tr class="clickable" data-player="${p.display_name}">
                <td>${p.display_name}</td>
                <td>${p.wins}</td>
                <td>${p.losses}</td>
                <td>${p.games_played}</td>
              </tr>`).join("")}
          </tbody>
        </table>
      </section>`;
    bind();
  }catch{error()}
}

/* ================= RECENT ================= */
async function recent(){
  loading();
  try{
    const d=await fetchJSON(API_BASE+"/");
    app.innerHTML=`
      <div class="card">
        <div class="card-header"><div class="card-title">Recent Matches</div></div>
        ${d.recent_matches.map(m=>`
          <div class="row clickable" data-match="${m.id||m.match_id}">
            <div>Winner: <strong>${m.winner}</strong></div>
            <div class="card-meta">${fmtDuration(m.duration_sec||0)}</div>
            <div class="card-meta">Open</div>
          </div>`).join("")}
      </div>`;
    bind();
  }catch{error()}
}

/* ================= SEARCH ================= */
async function search(q){
  loading();
  try{
    const ps=await fetchJSON(API_BASE+"/players?q="+encodeURIComponent(q));
    app.innerHTML=`
      <div class="card">
        <div class="card-header"><div class="card-title">Search</div></div>
        ${ps.map(p=>`
          <div class="row clickable" data-player="${p.name}">
            <div><strong>${p.name}</strong></div>
            <div class="card-meta">${p.wins}W</div>
            <div class="card-meta">${p.losses}L</div>
          </div>`).join("")}
      </div>`;
    bind();
  }catch{error()}
}

/* ================= PLAYER ================= */
async function player(name){
  loading();
  try{
    const d=await fetchJSON(API_BASE+"/player/"+encodeURIComponent(name));
    const p=d.profile;
    app.innerHTML=`
      <div class="card">
        <div class="player-hero">
          <div>
            <div class="player-name">${p.display_name}</div>
            <div class="player-sub">${p.games_played} games played</div>
          </div>
          <div class="stats">
            <div class="stat" id="stat-wins"><div class="stat-value">${p.wins}</div><div class="stat-label">Wins</div></div>
            <div class="stat" id="stat-losses"><div class="stat-value">${p.losses}</div><div class="stat-label">Losses</div></div>
            <div class="stat"><div class="stat-value">${p.games_played}</div><div class="stat-label">Total Games</div></div>
            <div class="stat" id="stat-words"><div class="stat-value">${p.total_words}</div><div class="stat-label">Total Words</div></div>
          </div>
        </div>
      </div>

      <div class="card" id="timeline">
        <div class="card-header"><div class="card-title">Recent Matches</div></div>
        ${d.timeline.map(t=>`
          <div class="row clickable" data-match="${t.match_id}" data-result="${t.result}">
            <div>Match ${t.match_id}</div>
            <span class="badge ${t.result}">${t.result}</span>
            <div class="card-meta">${t.ago}</div>
          </div>`).join("")}
      </div>`;
    bind();

    document.getElementById("stat-wins").onclick=()=>filterTimeline("win");
    document.getElementById("stat-losses").onclick=()=>filterTimeline("loss");
    document.getElementById("stat-words").onclick=()=>showAllWords(p.display_name,p.matches);
  }catch{error()}
}

function filterTimeline(type){
  document.querySelectorAll("#timeline .row").forEach(r=>{
    r.style.display = r.dataset.result===type ? "grid" : "none";
  });
}

async function showAllWords(playerName,matchIds){
  loading();
  try{
    let words=[];
    for(const id of matchIds){
      const m=await fetchJSON(API_BASE+"/match/"+id);
      const pl=m.players.find(x=>x.name===playerName);
      if(pl) words.push(...pl.words);
    }
    app.innerHTML=`
      <div class="card">
        <div class="card-header">
          <div class="card-title">All Words Used</div>
          <div class="card-meta">${words.length} total</div>
        </div>
        <ul class="words">${words.map(w=>`<li>${w}</li>`).join("")}</ul>
      </div>`;
  }catch{error()}
}

/* ================= MATCH ================= */
async function match(id){
  loading();
  try{
    const m=await fetchJSON(API_BASE+"/match/"+encodeURIComponent(id));
    app.innerHTML=`
      <div class="card">
        <div class="card-header">
          <div class="card-title">Match Details</div>
          <div class="match-meta">
            <div>Winner: <strong>${m.winner}</strong></div>
            <div>Duration: <strong>${fmtDuration(m.duration_sec)}</strong></div>
            <div>${new Date(m.played_at).toLocaleString()}</div>
          </div>
        </div>
        ${m.players.map(p=>`
          <div class="player-block">
            <strong>${p.name}</strong>
            <span class="badge ${p.result}">${p.result}</span>
            <div class="card-meta">${p.word_count} words</div>
            <ul class="words">${p.words.map(w=>`<li>${w}</li>`).join("")}</ul>
          </div>`).join("")}
      </div>`;
  }catch{error()}
}

/* ================= BIND ================= */
function bind(){
  document.querySelectorAll("[data-player]").forEach(e=>{
    e.onclick=()=>go("/player/"+encodeURIComponent(e.dataset.player));
  });
  document.querySelectorAll("[data-match]").forEach(e=>{
    e.onclick=()=>go("/match/"+encodeURIComponent(e.dataset.match));
  });
}

router();
</script>
</body>
</html>
