<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>☕ Blacktea Stats</title>

<!-- =========================================================
     ELITE, FINAL, ALL-FEATURES SINGLE-PAGE FRONTEND
     Vanilla HTML + CSS + JS
     ========================================================= -->

<style>
/* =========================================================
   RESET & VARIABLES
   ========================================================= */
:root{
  --bg:#0b1020;
  --bg-soft:#0f1530;
  --panel:#121833;
  --panel-2:#171f42;
  --panel-3:#1d2655;
  --border:#2a3470;

  --text:#f7f9ff;
  --muted:#aeb6df;
  --dim:#7e87b8;

  --accent:#6bb2ff;
  --accent-2:#8fc6ff;
  --accent-glow:rgba(107,178,255,.35);

  --win:#7fc4ff;
  --loss:#ff8b8b;

  --radius-xs:10px;
  --radius:16px;
  --radius-lg:24px;
  --radius-xl:32px;

  --shadow-sm:0 6px 20px rgba(0,0,0,.25);
  --shadow:0 16px 50px rgba(0,0,0,.45);
  --shadow-lg:0 30px 80px rgba(0,0,0,.65);

  --ease:cubic-bezier(.22,.61,.36,1);
  --fast:180ms;
  --mid:320ms;
  --slow:520ms;
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

html,body{
  width:100%;
  min-height:100%;
  background:linear-gradient(180deg,#0b1020,#090d1a 60%);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto;
  -webkit-font-smoothing:antialiased;
}

a{text-decoration:none;color:inherit}
button{font-family:inherit}

/* =========================================================
   GLOBAL ANIMATIONS
   ========================================================= */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(16px)}
  to{opacity:1;transform:none}
}
@keyframes fade{
  from{opacity:0}
  to{opacity:1}
}
@keyframes pop{
  from{opacity:0;transform:scale(.9)}
  to{opacity:1;transform:none}
}
@keyframes shimmer{
  0%{background-position:-200% 0}
  100%{background-position:200% 0}
}

/* =========================================================
   HEADER (BRANDING ONLY)
   ========================================================= */
header{
  position:sticky;
  top:0;
  z-index:100;
  background:rgba(11,16,32,.92);
  backdrop-filter:blur(14px);
  border-bottom:1px solid var(--border);
}
.header-inner{
  max-width:1600px;
  margin:auto;
  padding:26px 28px;
  font-size:28px;
  font-weight:900;
  letter-spacing:.5px;
}

/* =========================================================
   MAIN LAYOUT
   ========================================================= */
main{
  max-width:1600px;
  margin:auto;
  padding:56px 28px 140px;
  animation:fadeUp var(--mid) var(--ease) both;
}

/* =========================================================
   GENERIC UI
   ========================================================= */
.card{
  background:linear-gradient(180deg,var(--panel),var(--panel-2));
  border:1px solid var(--border);
  border-radius:var(--radius-xl);
  padding:34px;
  margin-bottom:44px;
  box-shadow:var(--shadow);
  animation:fadeUp var(--mid) var(--ease) both;
}
.card-title{
  font-size:24px;
  font-weight:900;
  margin-bottom:24px;
  letter-spacing:.3px;
}
.muted{color:var(--muted);font-size:14px}
.dim{color:var(--dim);font-size:13px}

.back{
  display:inline-flex;
  align-items:center;
  gap:10px;
  color:var(--accent);
  font-weight:800;
  cursor:pointer;
  margin-bottom:24px;
  transition:var(--fast) var(--ease);
}
.back:hover{
  transform:translateX(-4px);
  text-shadow:0 0 12px var(--accent-glow);
}

.btn{
  padding:14px 26px;
  border-radius:999px;
  border:none;
  background:linear-gradient(180deg,var(--accent-2),var(--accent));
  color:#061428;
  font-weight:900;
  cursor:pointer;
  transition:var(--fast) var(--ease);
}
.btn:hover{
  transform:translateY(-2px);
  box-shadow:0 0 0 10px rgba(107,178,255,.18),var(--shadow-lg);
}

/* =========================================================
   SEARCH (GOOGLE-STYLE)
   ========================================================= */
.search-wrap{
  max-width:720px;
  margin:0 auto 56px;
  position:relative;
  animation:fadeUp var(--mid) var(--ease) both;
}
.search-input{
  width:100%;
  padding:20px 26px;
  border-radius:999px;
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--panel),var(--panel-2));
  color:var(--text);
  font-size:17px;
}
.search-input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px var(--accent-glow);
}
.search-btn{
  position:absolute;
  right:8px;
  top:8px;
  bottom:8px;
  padding:0 26px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:#071427;
  font-weight:900;
  cursor:pointer;
}
.search-results{
  position:absolute;
  top:112%;
  width:100%;
  background:linear-gradient(180deg,var(--panel-2),var(--panel-3));
  border:1px solid var(--border);
  border-radius:22px;
  overflow:hidden;
  box-shadow:var(--shadow);
  animation:fade var(--fast) var(--ease) both;
  z-index:20;
}
.search-item{
  padding:16px 22px;
  cursor:pointer;
  transition:var(--fast) var(--ease);
}
.search-item:hover{
  background:rgba(255,255,255,.06);
}

/* =========================================================
   HOME ACTIONS
   ========================================================= */
.home-actions{
  display:flex;
  justify-content:flex-end;
  margin-bottom:30px;
}

/* =========================================================
   LEADERBOARD (CARD GRID)
   ========================================================= */
.lb-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:22px;
}
/* ===== Improved Leaderboard Cards ===== */
.lb-card{
  min-height:120px;                 /* was 160px */
  display:flex;
  flex-direction:column;
  justify-content:space-between;

  background:linear-gradient(180deg,#141c3a,#1a2450);
  border:1px solid var(--border);
  border-radius:18px;               /* slightly tighter */
  padding:20px;                     /* was 28px */

  cursor:pointer;
  transition:var(--mid) var(--ease);
}

.lb-card:hover{
  transform:translateY(-4px) scale(1.01);
  box-shadow:0 18px 40px rgba(0,0,0,.6);
  border-color:#ffd36b;
}

.lb-name{
  font-size:18px;
  font-weight:900;
  letter-spacing:.4px;
  color:#ffd36b; /* gold accent */
  text-shadow:0 0 12px rgba(255,211,107,.35);
}

.lb-winrate{
  margin-top:8px;
  font-size:20px;
  font-weight:900;
  color:var(--accent-2);
  letter-spacing:.3px;
}

.lb-winrate span{
  display:block;
  font-size:11px;
  font-weight:700;
  color:var(--dim);
  letter-spacing:.6px;
  text-transform:uppercase;
}


.lb-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.lb-arrow{
  font-size:22px;
  font-weight:900;
  color:var(--accent);
  opacity:.7;
  transition:transform var(--fast) var(--ease);
}

.lb-card:hover .lb-arrow{
  transform:translateX(6px);
  opacity:1;
}

.lb-metrics{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;                 /* tighter */
  margin-top:12px;         /* less spacing */
}

.lb-metric{
  background:rgba(255,255,255,.05);
  border-radius:10px;
  padding:8px 6px;
  text-align:center;
}

.lb-value{
  font-size:16px;          /* was 20px */
  font-weight:800;
}

.lb-label{
  font-size:10px;
  color:var(--dim);
  letter-spacing:.4px;
}
/* =========================================================
   MATCH ROWS & MATCH CARD
   ========================================================= */
.row{
  display:grid;
  grid-template-columns:1fr auto auto;
  gap:18px;
  padding:22px;
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  margin-bottom:18px;
  cursor:pointer;
  background:linear-gradient(180deg,var(--panel-2),var(--panel-3));
  transition:var(--mid) var(--ease);
}
.row:hover{
  transform:translateY(-6px);
  box-shadow:var(--shadow);
}

.match-hero{
  display:grid;
  grid-template-columns:1fr auto;
  gap:22px;
  align-items:center;
  margin-bottom:26px;
}
.match-title{
  font-size:26px;
  font-weight:900;
}
.match-meta{
  text-align:right;
}
.player-block{
  margin-top:28px;
  padding-top:22px;
  border-top:1px solid var(--border);
}
.player-header{
  display:flex;
  align-items:center;
  gap:14px;
  font-weight:800;
}
.badge{
  padding:6px 16px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
}
.badge.win{background:rgba(127,196,255,.22);color:var(--win)}
.badge.loss{background:rgba(255,139,139,.22);color:var(--loss)}

/* =========================================================
   PROFILE
   ========================================================= */
.profile-hero{
  display:grid;
  grid-template-columns:1.4fr 2.6fr;
  gap:36px;
}
.profile-name{
  font-size:36px;
  font-weight:900;
}
.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
}
.stat{
  background:linear-gradient(180deg,var(--panel-2),var(--panel-3));
  border-radius:var(--radius);
  padding:20px;
  text-align:center;
  animation:pop var(--fast) var(--ease) both;
}
.stat-value{
  font-size:26px;
  font-weight:900;
}
.stat-label{
  font-size:12px;
  color:var(--muted);
}

/* =========================================================
   WORDS & ANALYTICS
   ========================================================= */
.words{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:16px;
}
.word{
  padding:8px 16px;
  border-radius:999px;
  background:linear-gradient(180deg,var(--panel-3),#22306b);
  border:1px solid var(--border);
  font-size:13px;
  animation:pop var(--fast) var(--ease) both;
}

.chart{
  margin-top:24px;
}
.bar{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:12px;
}
.bar-label{
  width:110px;
  font-size:12px;
  color:var(--muted);
}
.bar-track{
  flex:1;
  height:14px;
  background:#1b2455;
  border-radius:999px;
  overflow:hidden;
}
.bar-fill{
  height:100%;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  border-radius:999px;
  animation:fade var(--fast) var(--ease) both;
}
.bar-count{
  width:40px;
  text-align:right;
  font-size:12px;
}

/* =========================================================
   COMPARE
   ========================================================= */
.compare-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:32px;
}
.compare-card{
  background:linear-gradient(180deg,var(--panel-2),var(--panel-3));
  border-radius:var(--radius-lg);
  padding:28px;
}

/* =========================================================
   MODAL
   ========================================================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:200;
  animation:fade var(--fast) var(--ease) both;
}
.modal-box{
  background:linear-gradient(180deg,var(--panel),var(--panel-2));
  border-radius:var(--radius-xl);
  padding:30px;
  width:460px;
  box-shadow:var(--shadow-lg);
}
.modal-title{
  font-size:22px;
  font-weight:900;
  margin-bottom:16px;
}
.modal input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--panel-2);
  color:var(--text);
}
.modal-list{
  margin-top:14px;
}
.modal-item{
  padding:12px;
  cursor:pointer;
  border-radius:10px;
}
.modal-item:hover{background:rgba(255,255,255,.06)}

/* =========================================================
   RESPONSIVE
   ========================================================= */
@media(max-width:1100px){
  .profile-hero,.compare-grid{grid-template-columns:1fr}
  .stats{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>
<header>
  <div class="header-inner">☕ Blacktea Stats</div>
</header>

<main id="app"></main>

<script>
/* =========================================================
   CORE APP LOGIC
   ========================================================= */
const API="https://tracker-s9qq.onrender.com";
const app=document.getElementById("app");

window.addEventListener("hashchange",router);

function go(p){location.hash="#"+p}
function dur(sec){return sec<60?sec+"s":(sec/60).toFixed(1)+" min"}
async function j(u){
  const r = await fetch(u).catch(() => null);
  if (!r) return null;
  if (!r.ok) return null;
  try {
    return await r.json();
  } catch {
    return null;
  }
}

/* =========================================================
   SEARCH
   ========================================================= */
let sTimer;
function renderSearch(){
  return `
    <div class="search-wrap">
      <input class="search-input" placeholder="Search players…" oninput="onSearch(this.value)">
      <button class="search-btn"
  onclick="onSearch(document.querySelector('.search-input').value)">
  Search
</button>
      <div id="search-results"></div>
    </div>`;
}
async function onSearch(q){
  clearTimeout(sTimer);
  const box=document.getElementById("search-results");
  if(!q){box.innerHTML="";return;}
  sTimer=setTimeout(async()=>{
    const ps=await j(API+"/players?q="+encodeURIComponent(q));
    box.innerHTML=`
      <div class="search-results">
        ${ps.map(p=>`
          <div class="search-item" onclick="go('/player/${encodeURIComponent(p.name)}')">
            ${p.name}
          </div>`).join("")}
      </div>`;
  },200);
}

/* =========================================================
   ROUTER
   ========================================================= */
function router(){
  const h=location.hash.slice(1)||"/";
  if(h==="/")home();
  else if(h==="/recent")recent();
  else if(h.startsWith("/player/"))player(decodeURIComponent(h.slice(8)));
  else if(h.startsWith("/match/"))match(decodeURIComponent(h.slice(7)));
  else if(h.startsWith("/compare/")){
    const [a,b]=h.slice(9).split("|");
    compare(a,b);
  }
}

/* =========================================================
   HOME
   ========================================================= */
async function home(){
  const d = await j(API + "/");

  if (!d) {
    app.innerHTML = `
      <div class="card">
        <div class="card-title">Backend unavailable</div>
        <div class="muted">Please wait a moment and refresh.</div>
      </div>`;
    return;
  }

  d.leaderboard.sort((a,b)=>b.wins-a.wins);

  app.innerHTML = `
    ${renderSearch()}

    <div class="home-actions">
      <button class="btn" onclick="go('/recent')">Recent Games</button>
    </div>

    <div class="card">
      <div class="card-title">Leaderboard</div>
      <div class="lb-grid">
        ${d.leaderboard.map(p=>`
          <div class="lb-card" onclick="go('/player/${encodeURIComponent(p.display_name)}')">
  <div class="lb-top">
    <div class="lb-name">
      ${p.display_name}
    </div>
    <div class="lb-arrow">→</div>
  </div>

  <div class="lb-winrate">
    ${(p.games_played
      ? ((p.wins / p.games_played) * 100).toFixed(1)
      : "0.0")}%
    <span>Win Rate</span>
  </div>
</div>
        `).join("")}
      </div>
    </div>`;
}
/* =========================================================
   RECENT
   ========================================================= */
async function recent(){
  const d=await j(API+"/");
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>
    <div class="card">
      <div class="card-title">Recent Games</div>
      ${d.recent_matches.map(m=>`
        <div class="row" onclick="go('/match/${m.id||m.match_id}')">
          <div><strong>${m.winner}</strong> won</div>
          <div class="muted">${dur(m.duration_sec||0)}</div>
          <div class="muted">Open</div>
        </div>`).join("")}
    </div>`;
}

/* =========================================================
   PLAYER PROFILE
   ========================================================= */
async function player(name){
  const d=await j(API+"/player/"+encodeURIComponent(name));

  let totalSeconds=0;
  let words=[];
  let bestWin=0;
  let curWin=0,curLoss=0;
  let current={type:null,count:0};

  for(const id of d.profile.matches){
    const m=await j(API+"/match/"+id);
    totalSeconds+=m.duration_sec;
    const p=m.players.find(x=>x.name===d.profile.display_name);
    if(p) words.push(...p.words);
  }

  d.timeline.forEach(t=>{
    if(t.result==="win"){
      curWin++;curLoss=0;
      bestWin=Math.max(bestWin,curWin);
      current={type:"Win",count:curWin};
    }else{
      curLoss++;curWin=0;
      current={type:"Loss",count:curLoss};
    }
  });

  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="profile-hero">
        <div>
          <div class="profile-name">${d.profile.display_name}</div>
          <div class="muted">
            ${d.profile.games_played} games · ${dur(totalSeconds)} total playtime
          </div>
          <div class="btn" style="margin-top:18px" onclick="openCompare('${d.profile.display_name}')">
            Compare Player
          </div>
        </div>

        <div class="stats">
          <div class="stat"><div class="stat-value">${d.profile.wins}</div><div class="stat-label">Wins</div></div>
          <div class="stat"><div class="stat-value">${d.profile.losses}</div><div class="stat-label">Losses</div></div>
          <div class="stat"><div class="stat-value">${d.profile.games_played}</div><div class="stat-label">Total Games</div></div>
          <div class="stat"><div class="stat-value">${words.length}</div><div class="stat-label">Total Words</div></div>
          <div class="stat"><div class="stat-value">${bestWin}</div><div class="stat-label">Best Win Streak</div></div>
          <div class="stat"><div class="stat-value">${current.count}</div><div class="stat-label">Current ${current.type}</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Recent Matches</div>
      ${d.timeline.map(t=>`
        <div class="row" onclick="go('/match/${t.match_id}')">
          <div>${t.result==="win"?"Victory":"Defeat"}</div>
          <div class="muted">${t.ago}</div>
          <div class="muted">Open</div>
        </div>`).join("")}
    </div>`;
}

/* =========================================================
   COMPARE MODAL & VIEW
   ========================================================= */
async function openCompare(a){
  const ps=await j(API+"/players?q=");
  document.body.insertAdjacentHTML("beforeend",`
    <div class="modal" onclick="this.remove()">
      <div class="modal-box" onclick="event.stopPropagation()">
        <div class="modal-title">Compare ${a} with…</div>
        <input placeholder="Search player…" oninput="filterCompare(this.value)">
        <div class="modal-list">
          ${ps.filter(p=>p.name!==a).map(p=>`
            <div class="modal-item" onclick="go('/compare/${encodeURIComponent(a)}|${encodeURIComponent(p.name)}')">
              ${p.name}
            </div>`).join("")}
        </div>
      </div>
    </div>`);
}
function filterCompare(q){
  document.querySelectorAll(".modal-item").forEach(i=>{
    i.style.display=i.textContent.toLowerCase().includes(q.toLowerCase())?"block":"none";
  });
}

async function compare(a,b){
  const A=await j(API+"/player/"+a);
  const B=await j(API+"/player/"+b);

  async function collect(p){
    let seconds=0, words=[];
    for(const id of p.profile.matches){
      const m=await j(API+"/match/"+id);
      seconds+=m.duration_sec;
      const pl=m.players.find(x=>x.name===p.profile.display_name);
      if(pl) words.push(...pl.words);
    }
    return {seconds,words};
  }

  const da=await collect(A);
  const db=await collect(B);

  const shared=[...new Set(da.words.filter(w=>db.words.includes(w)))];

  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="card-title">Player Comparison</div>
      <div class="compare-grid">
        ${compareCard(A,da)}
        ${compareCard(B,db)}
      </div>
    </div>

    <div class="card">
      <div class="card-title">Shared Words (${shared.length})</div>
      <div class="words">${shared.map(w=>`<div class="word">${w}</div>`).join("")}</div>
    </div>`;
}

function compareCard(p,d){
  const wr=(p.profile.wins/p.profile.games_played*100).toFixed(1);
  return `
    <div class="compare-card">
      <div class="profile-name">${p.profile.display_name}</div>
      <div class="muted">${p.profile.games_played} games</div>
      <div class="muted">${p.profile.wins}W · ${p.profile.losses}L · ${wr}% WR</div>
      <div class="muted">${dur(d.seconds)} playtime</div>
      <div class="muted">${d.words.length} total words</div>
      ${wordChart(d.words)}
    </div>`;
}

function wordChart(words){
  const freq={};
  words.forEach(w=>freq[w]=(freq[w]||0)+1);
  const entries=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const max=Math.max(...entries.map(e=>e[1]),1);

  return `
    <div class="chart">
      ${entries.map(([w,c])=>`
        <div class="bar">
          <div class="bar-label">${w}</div>
          <div class="bar-track">
            <div class="bar-fill" style="width:${(c/max)*100}%"></div>
          </div>
          <div class="bar-count">${c}</div>
        </div>`).join("")}
    </div>`;
}

/* =========================================================
   MATCH VIEW
   ========================================================= */
async function match(id){
  const m=await j(API+"/match/"+id);
  app.innerHTML=`
    <div class="back" onclick="history.back()">← Back</div>

    <div class="card">
      <div class="match-hero">
        <div>
          <div class="match-title">${m.winner} won the match</div>
          <div class="dim">Match ID · ${m.id}</div>
        </div>
        <div class="match-meta">
          <div class="muted">${dur(m.duration_sec)}</div>
          <div class="dim">${new Date(m.played_at).toLocaleString()}</div>
        </div>
      </div>

      ${m.players.map(p=>`
        <div class="player-block">
          <div class="player-header">
            ${p.name}
            <span class="badge ${p.result}">${p.result}</span>
            <span class="dim">${p.word_count} words</span>
          </div>
          <div class="words">
            ${p.words.map(w=>`<div class="word">${w}</div>`).join("")}
          </div>
        </div>`).join("")}
    </div>`;
}

router();
</script>
</body>
</html>     
     
